name: Publish Python Package

on:
  pull_request:
    branches: ["main"]
  # release:
  #   types: [created]

jobs:
  deploy:
    runs-on: ubuntu-latest
    environment:
      name: pypi
      url: https://pypi.org/p/mangum/${{ steps.my_step.outputs.version }}

    steps:
    - uses: actions/checkout@v4

    - name: Install uv
      uses: astral-sh/setup-uv@v2
      with:
        version: "0.4.12"
        enable-cache: true

    - name: Set up Python
      run: uv python install 3.12

    - name: Install dependencies
      run: uv build

    - name: Publish to PyPI
      id: my_step
      run: |
        echo "version=0.1.0" >> "$GITHUB_OUTPUT"
